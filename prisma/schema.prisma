generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String        @id @default(uuid())
  email             String        @unique
  username          String        @unique
  password          String?
  role              Role          @default(PLAYER)
  profile           Profile?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  clubs             ClubMember[]
  services          Service[]
  invitationsSent   ClubMember[]  @relation("InvitedBy")
}

model Profile {
  id          String   @id @default(uuid())
  displayName String   @default("")
  bio         String?
  avatarUrl   String?
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Club {
  id        String       @id @default(uuid())
  name      String
  location  String?
  teams     Team[]
  members   ClubMember[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@index([name])
}

model Team {
  id        String       @id @default(uuid())
  name      String
  category  String
  club      Club         @relation(fields: [clubId], references: [id], onDelete: Cascade)
  clubId    String
  players   ClubMember[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model ClubMember {
  id          String           @id @default(uuid())
  club        Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  clubId      String
  team        Team?            @relation(fields: [teamId], references: [id], onDelete: SetNull)
  teamId      String?
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  roleInClub  ClubRole         @default(MEMBER)
  status      MembershipStatus @default(PENDING)
  inviter     User?            @relation("InvitedBy", fields: [invitedById], references: [id], onDelete: SetNull)
  invitedById String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@unique([clubId, userId])
  @@index([userId, status])
  @@index([clubId, status])
}

model Service {
  id          String   @id @default(uuid())
  title       String
  description String
  provider    User     @relation(fields: [providerId], references: [id], onDelete: Cascade)
  providerId  String
  priceAmount Float?
  currency    Currency?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Role {
  PLAYER
  COACH
  CLUB_ADMIN
  SUPERADMIN
}

enum ClubRole {
  MEMBER
  CAPTAIN
  COACH
}

enum MembershipStatus {
  PENDING
  ACTIVE
  REJECTED
}

enum Currency {
  USD
  EUR
  GBP
  CAD
  AUD
  JPY
  ARS
}
